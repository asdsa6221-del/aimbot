--// =========================
--// Developer ESP + Toggle UI + NoClip
--// =========================

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local ESP_ENABLED = true
local NOCLIP_ENABLED = false
local playerRoot = nil

--// =========================
--// Create Toggle Menu (UI)
--// =========================

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "DevESPGui"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- ESP Toggle Button
local ToggleESP = Instance.new("TextButton")
ToggleESP.Size = UDim2.new(0, 200, 0, 50)
ToggleESP.Position = UDim2.new(0, 20, 0, 200)
ToggleESP.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
ToggleESP.BorderSizePixel = 0
ToggleESP.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleESP.Font = Enum.Font.GothamBold
ToggleESP.TextSize = 20
ToggleESP.Text = "ESP: ON"
ToggleESP.Parent = ScreenGui

ToggleESP.MouseButton1Click:Connect(function()
    ESP_ENABLED = not ESP_ENABLED
    ToggleESP.Text = "ESP: " .. (ESP_ENABLED and "ON" or "OFF")
    
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr.Character then
            local esp = plr.Character:FindFirstChild("DevESP")
            if esp then
                esp.Enabled = ESP_ENABLED
            end
            local nameTag = plr.Character:FindFirstChild("DevNameTag")
            if nameTag then
                nameTag.Enabled = ESP_ENABLED
            end
        end
    end
end)

-- NoClip Toggle Button
local ToggleNoClip = Instance.new("TextButton")
ToggleNoClip.Size = UDim2.new(0, 200, 0, 50)
ToggleNoClip.Position = UDim2.new(0, 20, 0, 260)
ToggleNoClip.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
ToggleNoClip.BorderSizePixel = 0
ToggleNoClip.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleNoClip.Font = Enum.Font.GothamBold
ToggleNoClip.TextSize = 20
ToggleNoClip.Text = "NoClip: OFF"
ToggleNoClip.Parent = ScreenGui

ToggleNoClip.MouseButton1Click:Connect(function()
    NOCLIP_ENABLED = not NOCLIP_ENABLED
    ToggleNoClip.Text = "NoClip: " .. (NOCLIP_ENABLED and "ON" or "OFF")
end)

--// =========================
--// ESP Creation Function
--// =========================

local function createESP(character, player)
    if character:FindFirstChild("DevESP") then return end

    -- Highlight (Box) through walls
    local hl = Instance.new("Highlight")
    hl.Name = "DevESP"
    hl.FillColor = Color3.fromRGB(255, 0, 0)
    hl.OutlineColor = Color3.fromRGB(255, 0, 0)
    hl.FillTransparency = 0.7
    hl.Enabled = ESP_ENABLED
    hl.Parent = character

    -- Name Tag above head
    local head = character:FindFirstChild("Head")
    if head then
        local billboard = Instance.new("BillboardGui")
        billboard.Name = "DevNameTag"
        billboard.Adornee = head
        billboard.Size = UDim2.new(0, 100, 0, 40)
        billboard.StudsOffset = Vector3.new(0, 2.5, 0)
        billboard.AlwaysOnTop = true
        billboard.Enabled = ESP_ENABLED
        billboard.Parent = character

        local textLabel = Instance.new("TextLabel")
        textLabel.Size = UDim2.new(1, 0, 1, 0)
        textLabel.BackgroundTransparency = 1
        textLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
        textLabel.TextStrokeTransparency = 0
        textLabel.Font = Enum.Font.GothamBold
        textLabel.TextSize = 18
        textLabel.Text = player.Name
        textLabel.Parent = billboard
    end
end

--// Apply ESP to a player
local function setupPlayer(player)
    player.CharacterAdded:Connect(function(char)
        char:WaitForChild("HumanoidRootPart", 5)
        createESP(char, player)
    end)

    if player.Character then
        createESP(player.Character, player)
    end
end

-- Listen for players joining
Players.PlayerAdded:Connect(setupPlayer)

-- Apply to existing players
for _, plr in ipairs(Players:GetPlayers()) do
    setupPlayer(plr)
end

--// =========================
--// NoClip Logic
--// =========================

RunService.Stepped:Connect(function()
    local character = LocalPlayer.Character
    if character and NOCLIP_ENABLED then
        local hrp = character:FindFirstChild("HumanoidRootPart")
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if hrp and humanoid then
            -- Disable collisions for all parts
            for _, part in pairs(character:GetChildren()) do
                if part:IsA("BasePart") then
                    part.CanCollide = false
                end
            end
            humanoid:ChangeState(Enum.HumanoidStateType.Physics)
        end
    elseif character then
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            -- Re-enable collisions when NoClip off
            for _, part in pairs(character:GetChildren()) do
                if part:IsA("BasePart") then
                    part.CanCollide = true
                end
            end
        end
    end
end)

print("Developer ESP + NoClip Loaded âœ”")
