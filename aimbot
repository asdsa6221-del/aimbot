-- Services
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera

-- GUI Setup
local ScreenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
ScreenGui.Name = "AdminPanel"
ScreenGui.IgnoreGuiInset = true
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.DisplayOrder = 999

local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 250, 0, 600)
Frame.Position = UDim2.new(0, 50, 0, 50)
Frame.BackgroundColor3 = Color3.fromRGB(65,105,225)
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true

local Title = Instance.new("TextLabel", Frame)
Title.Size = UDim2.new(1,0,0,50)
Title.Text = "Adams premium üëë"
Title.TextColor3 = Color3.fromRGB(255,255,255)
Title.BackgroundTransparency = 1
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 24

-- WalkSpeed
local defaultWalkSpeed = 16
local SpeedBox = Instance.new("TextBox", Frame)
SpeedBox.Position = UDim2.new(0.5,5,0,60)
SpeedBox.Size = UDim2.new(0.5,-15,0,30)
SpeedBox.PlaceholderText = tostring(defaultWalkSpeed)
SpeedBox.Text = ""
SpeedBox.ClearTextOnFocus = false
SpeedBox.BackgroundColor3 = Color3.fromRGB(70,70,70)
SpeedBox.TextColor3 = Color3.new(1,1,1)
SpeedBox.Font = Enum.Font.SourceSans
SpeedBox.TextSize = 18
SpeedBox.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        local value = tonumber(SpeedBox.Text)
        if value and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.WalkSpeed = value
        end
    end
end)


------------------------------------------------------------
-- ‚úàÔ∏è NEW FLY SPEED BOX (ONLY ADDITION)
------------------------------------------------------------
local flySpeed = 100

local FlySpeedBox = Instance.new("TextBox", Frame)
FlySpeedBox.Position = UDim2.new(0.5,5,0,105)
FlySpeedBox.Size = UDim2.new(0.5,-15,0,30)
FlySpeedBox.PlaceholderText = "Fly Speed"
FlySpeedBox.Text = ""
FlySpeedBox.ClearTextOnFocus = false
FlySpeedBox.BackgroundColor3 = Color3.fromRGB(70,70,70)
FlySpeedBox.TextColor3 = Color3.new(1,1,1)
FlySpeedBox.Font = Enum.Font.SourceSans
FlySpeedBox.TextSize = 18

FlySpeedBox.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        local v = tonumber(FlySpeedBox.Text)
        if v then flySpeed = v end
    end
end)
------------------------------------------------------------


-- Fly
local flyEnabled = false
local flyButton = Instance.new("TextButton", Frame)
flyButton.Position = UDim2.new(0,10,0,150)
flyButton.Size = UDim2.new(1,-20,0,40)
flyButton.Text = "Toggle Fly"
flyButton.BackgroundColor3 = Color3.fromRGB(70,70,70)
flyButton.TextColor3 = Color3.new(1,1,1)

local keysDown = {}

flyButton.MouseButton1Click:Connect(function()
    flyEnabled = not flyEnabled
    flyButton.BackgroundColor3 = flyEnabled and Color3.fromRGB(0,255,0) or Color3.fromRGB(70,70,70)
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("Humanoid") then
        char.Humanoid.PlatformStand = flyEnabled
    end
end)

UserInputService.InputBegan:Connect(function(input, processed)
    if processed then return end
    if input.UserInputType == Enum.UserInputType.Keyboard then
        keysDown[input.KeyCode] = true
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Keyboard then
        keysDown[input.KeyCode] = false
    end
end)


-- Infinite Jump
local infiniteJump = false
local JumpButton = Instance.new("TextButton", Frame)
JumpButton.Position = UDim2.new(0,10,0,200)
JumpButton.Size = UDim2.new(1,-20,0,40)
JumpButton.Text = "Toggle Infinite Jump"
JumpButton.BackgroundColor3 = Color3.fromRGB(70,70,70)
JumpButton.TextColor3 = Color3.new(1,1,1)

JumpButton.MouseButton1Click:Connect(function()
    infiniteJump = not infiniteJump
    JumpButton.BackgroundColor3 = infiniteJump and Color3.fromRGB(0,255,0) or Color3.fromRGB(70,70,70)
end)

UserInputService.JumpRequest:Connect(function()
    if infiniteJump and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        LocalPlayer.Character.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)


-- NoClip
local autoNoClipEnabled = false
local NoClipButton = Instance.new("TextButton", Frame)
NoClipButton.Position = UDim2.new(0,10,0,250)
NoClipButton.Size = UDim2.new(1,-20,0,40)
NoClipButton.Text = "Toggle NoClip"
NoClipButton.BackgroundColor3 = Color3.fromRGB(70,70,70)
NoClipButton.TextColor3 = Color3.new(1,1,1)

NoClipButton.MouseButton1Click:Connect(function()
    autoNoClipEnabled = not autoNoClipEnabled
    NoClipButton.BackgroundColor3 = autoNoClipEnabled and Color3.fromRGB(0,255,0) or Color3.fromRGB(70,70,70)
end)


-- Hitbox Breaker BUTTON
local hitboxBreaker = false
local HitboxButton = Instance.new("TextButton", Frame)
HitboxButton.Position = UDim2.new(0,10,0,300)
HitboxButton.Size = UDim2.new(1,-20,0,40)
HitboxButton.Text = "Hitbox Breaker"
HitboxButton.BackgroundColor3 = Color3.fromRGB(70,70,70)
HitboxButton.TextColor3 = Color3.new(1,1,1)

HitboxButton.MouseButton1Click:Connect(function()
    hitboxBreaker = not hitboxBreaker
    HitboxButton.BackgroundColor3 = hitboxBreaker and Color3.fromRGB(0,255,0) or Color3.fromRGB(70,70,70)
end)


-- ESP
local espEnabled = false
local espBoxes = {}

local ESPButton = Instance.new("TextButton", Frame)
ESPButton.Position = UDim2.new(0,10,0,350)
ESPButton.Size = UDim2.new(1,-20,0,40)
ESPButton.Text = "Toggle ESP"
ESPButton.BackgroundColor3 = Color3.fromRGB(70,70,70)
ESPButton.TextColor3 = Color3.new(1,1,1)

ESPButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    ESPButton.BackgroundColor3 = espEnabled and Color3.fromRGB(0,255,0) or Color3.fromRGB(70,70,70)
end)


local function createOrUpdateESP(player, color)
    if not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end
    if not espBoxes[player] then
        local box = Instance.new("BoxHandleAdornment")
        box.Adornee = player.Character.HumanoidRootPart
        box.AlwaysOnTop = true
        box.ZIndex = 10
        box.Parent = workspace
        espBoxes[player] = box
    end
    local box = espBoxes[player]
    box.Adornee = player.Character.HumanoidRootPart
    box.Color3 = color
    box.Size = Vector3.new(4,6,2)
    box.Transparency = 0.5
end

local function removeESP(player)
    if espBoxes[player] then
        espBoxes[player]:Destroy()
        espBoxes[player] = nil
    end
end


Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        task.wait(0.1)
        if espEnabled then
            createOrUpdateESP(player, Color3.fromRGB(0,255,0))
        end
    end)
end)


-- Lock-On
local lockOn = false
local LockButton = Instance.new("TextButton", Frame)
LockButton.Position = UDim2.new(0,10,0,400)
LockButton.Size = UDim2.new(1,-20,0,40)
LockButton.Text = "Toggle Lock-On"
LockButton.BackgroundColor3 = Color3.fromRGB(70,70,70)
LockButton.TextColor3 = Color3.new(1,1,1)

LockButton.MouseButton1Click:Connect(function()
    lockOn = not lockOn
    LockButton.BackgroundColor3 = lockOn and Color3.fromRGB(0,255,0) or Color3.fromRGB(70,70,70)
    if lockOn then
        espEnabled = true
        ESPButton.BackgroundColor3 = Color3.fromRGB(0,255,0)
    end
end)


-- Enemy Lock-On
local enemyLockOn = false
local EnemyLockButton = Instance.new("TextButton", Frame)
EnemyLockButton.Position = UDim2.new(0,10,0,450)
EnemyLockButton.Size = UDim2.new(1,-20,0,40)
EnemyLockButton.Text = "Enemy Lock (Arsenal)"
EnemyLockButton.BackgroundColor3 = Color3.fromRGB(70,70,70)
EnemyLockButton.TextColor3 = Color3.new(1,1,1)

EnemyLockButton.MouseButton1Click:Connect(function()
    enemyLockOn = not enemyLockOn
    EnemyLockButton.BackgroundColor3 = enemyLockOn and Color3.fromRGB(0,255,0) or Color3.fromRGB(70,70,70)
end)


-- Nearest Player Functions
local function getNearestPlayer()
    local nearest = nil
    local shortestDistance = math.huge
    local lpChar = LocalPlayer.Character
    if not lpChar or not lpChar:FindFirstChild("HumanoidRootPart") then return nil end
    local lpPos = lpChar.HumanoidRootPart.Position

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local distance = (player.Character.HumanoidRootPart.Position - lpPos).Magnitude
            if distance < shortestDistance then
                shortestDistance = distance
                nearest = player
            end
        end
    end
    return nearest
end


local function getNearestEnemyPlayer()
    local nearest = nil
    local shortestDistance = math.huge
    local lpChar = LocalPlayer.Character
    local lpTeam = LocalPlayer.Team
    if not lpChar or not lpChar:FindFirstChild("HumanoidRootPart") then return nil end
    local lpPos = lpChar.HumanoidRootPart.Position

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Team ~= lpTeam and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local distance = (player.Character.HumanoidRootPart.Position - lpPos).Magnitude
            if distance < shortestDistance then
                shortestDistance = distance
                nearest = player
            end
        end
    end
    return nearest
end


-- Custom Lock-On
local customLockOn = false
local selectedPlayers = {}

local CustomLockButton = Instance.new("TextButton", Frame)
CustomLockButton.Position = UDim2.new(0,10,0,500)
CustomLockButton.Size = UDim2.new(1,-20,0,40)
CustomLockButton.Text = "Custom Lock-On"
CustomLockButton.BackgroundColor3 = Color3.fromRGB(70,70,70)
CustomLockButton.TextColor3 = Color3.new(1,1,1)


local SelectionFrame = Instance.new("Frame", ScreenGui)
SelectionFrame.Size = UDim2.new(0, 300, 0, 400)
SelectionFrame.Position = UDim2.new(0.5, -150, 0, 20)
SelectionFrame.BackgroundColor3 = Color3.fromRGB(50,50,50)
SelectionFrame.Visible = false
SelectionFrame.Active = true
SelectionFrame.Draggable = true

local SearchBox = Instance.new("TextBox", SelectionFrame)
SearchBox.Size = UDim2.new(1, -20, 0, 32)
SearchBox.Position = UDim2.new(0, 10, 0, 10)
SearchBox.PlaceholderText = "Search players..."
SearchBox.ClearTextOnFocus = false
SearchBox.BackgroundColor3 = Color3.fromRGB(70,70,70)
SearchBox.TextColor3 = Color3.new(1,1,1)
SearchBox.Font = Enum.Font.SourceSans
SearchBox.TextSize = 18


local CloseButton = Instance.new("TextButton", SelectionFrame)
CloseButton.Position = UDim2.new(1,-35,0,5)
CloseButton.Size = UDim2.new(0,30,0,30)
CloseButton.Text = "X"
CloseButton.BackgroundColor3 = Color3.fromRGB(150,0,0)
CloseButton.TextColor3 = Color3.new(1,1,1)

CloseButton.MouseButton1Click:Connect(function()
    SelectionFrame.Visible = false
end)


local function refreshPlayerList()
    for _, child in pairs(SelectionFrame:GetChildren()) do
        if child:IsA("TextButton") and child ~= CloseButton then
            child:Destroy()
        end
    end

    local yPos = 52
    local query = tostring(SearchBox.Text or ""):lower()

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local nameLower = player.Name:lower()
            if query == "" or string.find(nameLower, query, 1, true) then
                local btn = Instance.new("TextButton", SelectionFrame)
                btn.Position = UDim2.new(0,10,0,yPos)
                btn.Size = UDim2.new(1,-20,0,30)
                btn.Text = player.Name
                btn.BackgroundColor3 = Color3.fromRGB(70,70,70)
                btn.TextColor3 = Color3.new(1,1,1)

                btn.MouseButton1Click:Connect(function()
                    local exists = false
                    for _,p in pairs(selectedPlayers) do
                        if p == player then exists = true end
                    end
                    if exists then
                        for i,p in pairs(selectedPlayers) do
                            if p == player then table.remove(selectedPlayers,i) break end
                        end
                        btn.BackgroundColor3 = Color3.fromRGB(70,70,70)
                    else
                        table.insert(selectedPlayers, player)
                        btn.BackgroundColor3 = Color3.fromRGB(0,255,0)
                    end
                end)

                yPos = yPos + 40
            end
        end
    end
end

SearchBox:GetPropertyChangedSignal("Text"):Connect(function()
    refreshPlayerList()
end)


Players.PlayerAdded:Connect(function()
    refreshPlayerList()
end)

Players.PlayerRemoving:Connect(function()
    refreshPlayerList()
end)


CustomLockButton.MouseButton1Click:Connect(function()
    customLockOn = not customLockOn
    CustomLockButton.BackgroundColor3 = customLockOn and Color3.fromRGB(0,255,0) or Color3.fromRGB(70,70,70)
    SelectionFrame.Visible = true
    refreshPlayerList()
end)


---------------------------------------------------
-- üöÅ NEW: DRONE MODE BUTTON INTEGRATION
---------------------------------------------------
local droneMode = false
local DroneButton = Instance.new("TextButton", Frame)
DroneButton.Position = UDim2.new(0,10,0,550) -- Positioned 50 pixels below Custom Lock-On (500 + 50)
DroneButton.Size = UDim2.new(1,-20,0,40)
DroneButton.Text = "Toggle Drone Mode"
DroneButton.BackgroundColor3 = Color3.fromRGB(70,70,70)
DroneButton.TextColor3 = Color3.new(1,1,1)

DroneButton.MouseButton1Click:Connect(function()
    droneMode = not droneMode
    DroneButton.BackgroundColor3 = droneMode and Color3.fromRGB(0,255,0) or Color3.fromRGB(70,70,70)
end)


---------------------------------------------------
-- üöÅ DRONE MODE VARIABLES (From your second script)
---------------------------------------------------
local CHARACTER, HRP, HEAD
local angle = 0
local HOVER = 18
local RADIUS = 10
local ORBIT_SPEED = 2.1
local DODGE_CHANCE = 0.02
local DODGE_STRENGTH = 8
local JITTER_STRENGTH = 0.15

LocalPlayer.CharacterAdded:Connect(function(char)
    CHARACTER = char
    HRP = char:WaitForChild("HumanoidRootPart")
    HEAD = char:WaitForChild("Head")
end)

if LocalPlayer.Character then
    CHARACTER = LocalPlayer.Character
    HRP = CHARACTER:WaitForChild("HumanoidRootPart")
    HEAD = CHARACTER:WaitForChild("Head")
end

local function getNearest() -- Renamed from getNearest() in the drone script to avoid conflict with the admin panel's getNearestPlayer, and made it the drone version.
    if not HRP then return nil end

    local nearest, dist = nil, 9999
    local origin = HRP.Position

    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("Head") then
            local head = plr.Character.Head
            local d = (head.Position - origin).Magnitude
            if d < dist and d < 450 then
                nearest = head
                dist = d
            end
        end
    end

    return nearest
end


-- MAIN LOOP
RunService.RenderStepped:Connect(function(dt)
    local char = LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
    local hrp = char.HumanoidRootPart

    ---------------------------------------------------
    -- üõ´ FLY MOVEMENT (NOW USES flySpeed FROM BOX)
    ---------------------------------------------------
    if flyEnabled then
        local camCFrame = Camera.CFrame
        local direction = Vector3.new()

        if keysDown[Enum.KeyCode.W] then direction += camCFrame.LookVector end
        if keysDown[Enum.KeyCode.S] then direction -= camCFrame.LookVector end
        if keysDown[Enum.KeyCode.A] then direction -= camCFrame.RightVector end
        if keysDown[Enum.KeyCode.D] then direction += camCFrame.RightVector end
        if keysDown[Enum.KeyCode.Space] then direction += Vector3.new(0,1,0) end
        if keysDown[Enum.KeyCode.LeftShift] then direction -= Vector3.new(0,1,0) end

        hrp.Velocity = direction.Magnitude > 0 and direction.Unit * flySpeed or Vector3.new()
    end


    ---------------------------------------------------
    -- ü§ñ DRONE MODE (Your new feature)
    ---------------------------------------------------
    if droneMode and HRP then
        local targetHead = getNearest()
        if targetHead then
            local targetPos = targetHead.Position

            -- JITTER CORRECTION (smooths camera)
            local camDir = (targetPos - Camera.CFrame.Position).Unit
            local safeCam = CFrame.lookAt(
                Camera.CFrame.Position,
                Camera.CFrame.Position + camDir
            )
            Camera.CFrame = Camera.CFrame:Lerp(safeCam, JITTER_STRENGTH)

            -- BODY ROTATION (keeps gun accurate)
            local lookCF = CFrame.lookAt(HRP.Position, targetPos)
            HRP.CFrame = HRP.CFrame:Lerp(lookCF, 0.45)

            -- DRONE ORBIT MOVEMENT
            angle += dt * ORBIT_SPEED
            local circleOffset = Vector3.new(
                math.cos(angle) * RADIUS,
                HOVER,
                math.sin(angle) * RADIUS
            )
            local goalPos = targetPos + circleOffset

            -- AUTO DODGE (random small burst movement)
            if math.random() < DODGE_CHANCE then
                goalPos += Vector3.new(
                    math.random(-DODGE_STRENGTH, DODGE_STRENGTH),
                    math.random(2,5),
                    math.random(-DODGE_STRENGTH, DODGE_STRENGTH)
                )
            end

            -- MOVE WITHOUT BREAKING GUNS OR CAMERA
            local newPos = HRP.Position:Lerp(goalPos, 0.1)
            HRP.CFrame = CFrame.new(newPos, targetPos)

            -- ARM LOCK (accurate shots)
            if char then
                local rArm = char:FindFirstChild("RightUpperArm")
                local lArm = char:FindFirstChild("LeftUpperArm")
                if rArm then rArm.CFrame = CFrame.lookAt(rArm.Position, targetPos) end
                if lArm then lArm.CFrame = CFrame.lookAt(lArm.Position, targetPos) end
            end
        end
    end


    -- Lock-On
    if lockOn then
        local target = getNearestPlayer()
        if target and target.Character and target.Character:FindFirstChild("Head") then
            hrp.CFrame = CFrame.new(hrp.Position, target.Character.Head.Position)
            Camera.CFrame = CFrame.lookAt(Camera.CFrame.Position, target.Character.Head.Position)
        end
    end

    -- Enemy Lock-On
    if enemyLockOn then
        local target = getNearestEnemyPlayer()
        if target and target.Character and target.Character:FindFirstChild("Head") then
            hrp.CFrame = CFrame.new(hrp.Position, target.Character.Head.Position)
            Camera.CFrame = CFrame.lookAt(Camera.CFrame.Position, target.Character.Head.Position)
        end
    end

    -- Custom Lock-On
    if customLockOn and #selectedPlayers > 0 then
        local nearest = nil
        local shortestDistance = math.huge
        for _, player in pairs(selectedPlayers) do
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local distance = (player.Character.HumanoidRootPart.Position - hrp.Position).Magnitude
                if distance < shortestDistance then
                    shortestDistance = distance
                    nearest = player
                end
            end
        end

        if nearest and nearest.Character and nearest.Character:FindFirstChild("Head") then
            hrp.CFrame = CFrame.new(hrp.Position, nearest.Character.Head.Position)
            Camera.CFrame = CFrame.lookAt(Camera.CFrame.Position, nearest.Character.Head.Position)
        end
    end

    -- Crazy Spin Sit
    if hitboxBreaker then
        local hum = char:FindFirstChild("Humanoid")
        if hum then hum.Sit = true end
        hrp.CFrame = hrp.CFrame * CFrame.Angles(math.rad(6), math.rad(4), math.rad(6))
    end

    -- NoClip
    if autoNoClipEnabled then
        for _, part in pairs(char:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end

    -- ESP update
    if espEnabled then
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local humanoid = player.Character:FindFirstChild("Humanoid")
                if humanoid and humanoid.Health > 0 then
                    local isEnemy = (player.Team ~= LocalPlayer.Team)
                    local color = isEnemy and Color3.fromRGB(255,0,0) or Color3.fromRGB(0,255,0)
                    createOrUpdateESP(player, color)
                else
                    removeESP(player)
                end
            end
        end
    else
        for player, box in pairs(espBoxes) do
            box:Destroy()
            espBoxes[player] = nil
        end
    end
end)
